<!DOCTYPE html>
<html>
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@300&display=swap" rel="stylesheet">

<head>
  <meta name="Pei Pei Barth Wu" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="index.css">
</head>

<body>
  <div class="fixed">
    <img src="img/namered.png" alt="Virtual House" style="width:20%; padding-top: 2%;">
  </div>

  <div class="fixed">
    <div class="text" style="float: right;">
      [Press Space or Tap]
    </div>
  </div>
  <div class="fixed">
    <div class="text" style="float: left;">
      <a href="./home.html">
        Info
      </a>

    </div>
  </div>

  <!-- 3D -->
  <script src="three/three.js"></script>
  <script src="three/GLTFLoader.js"></script>
  <script src="three/OrbitControls.js"></script>
  <div id="three">
    <script src="threejs/build/three.js"></script>
    <script src="threejs/examples/js/loaders/GLTFLoader.js"></script>
    <script type="module">
      import { OrbitControls } from '/threejs/examples/js/controls/OrbitControls.js';
      import { EffectComposer } from '/threejs/examples/jsm/postprocessing/EffectComposer.js';
      import { RenderPass } from '/threejs/examples/jsm/postprocessing/RenderPass.js';
      import { UnrealBloomPass } from '/threejs/examples/jsm/postprocessing/UnrealBloomPass.js';
      import { FilmPass } from '/threejs/examples/jsm/postprocessing/FilmPass.js';

      //essentials
      let scene, camera, renderer, composer, model, screen, loader;

      //clouds
      let cloudParticles = [];
      let images = ["bit.png", "game.png", "guivilleassets.png", "sixthwall.png", "bedroom2.png"];
      let url;
      let assetList = [];
      let screenMaterial;


      function init() {

        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x855481);

        camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 1, 1000);
        camera.position.x = 5.25;
        camera.rotation.y = Math.PI / 2;

        let cloudLight = new THREE.PointLight(0x855481, 10, 0);
        cloudLight.position.set(-1, -19, 4);
        scene.add(cloudLight);

        var container = document.getElementById('three');

        renderer = new THREE.WebGLRenderer({ antialias: true, three });
        renderer.setSize(window.innerWidth, window.innerHeight);
        container.appendChild(renderer.domElement);

        // const controls = new OrbitControls( camera, renderer.domElement );

        /**
        * clouds
        **/
        loader = new THREE.TextureLoader();
        loader.load("img/smoke.png", function (texture) {
          const cloudGeo = new THREE.PlaneBufferGeometry(30, 40);
          const cloudMaterial = new THREE.MeshLambertMaterial({
            map: texture,
            transparent: true
          });

          for (let p = 0; p < 15; p++) {
            let cloud = new THREE.Mesh(cloudGeo, cloudMaterial);
            cloud.position.set(
              -p, //forward
              Math.random() * 5 - 10, //height
              Math.random() * 10 - 5 //side to side
            );
            cloud.rotation.y = Math.PI / 2;
            cloud.rotation.z = Math.random() * 2 * Math.PI;
            cloud.material.opacity = 0.35;
            cloudParticles.push(cloud);
            scene.add(cloud);
          }
        });

        /**
        * computer
        **/
        for (let i = 0; i < images.length; i++) {
          url = "img/" + images[i];
          assetList.push(url);
        }

        screenMaterial = new THREE.MeshStandardMaterial({
          emissive: 0xffffff,
          emissiveIntensity: 1,
          emissiveMap: loader.load("img/screen1.png"),
        });


        const gloader = new THREE.GLTFLoader();
        gloader.load('models/computer2021.gltf', function (gltf) {
          model = gltf.scene.getObjectByName("computer");
          screen = gltf.scene.getObjectByName("screen");
          screen.material = screenMaterial;
          scene.add(gltf.scene);
        }, undefined, function (error) {
          console.error(error);
        });

        /**
        * Post Processing
        **/
        composer = new EffectComposer(renderer);
        const renderPass = new RenderPass(scene, camera);
        composer.addPass(renderPass);

        //  const filmPass = new FilmPass(0.1, 0.3, 300, false);
        //  composer.addPass( filmPass );
        render();
      }

      function render() {
        cloudParticles.forEach(p => { //move clouds
          p.rotation.z += 0.0005;
        });
        composer.render(); //render and post
        requestAnimationFrame(render);
      }


      init();


      //event listeners

      window.addEventListener('resize', onWindowResize, false);
      function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();

        renderer.setSize(window.innerWidth, window.innerHeight);
      }

      var count = 0;
      window.addEventListener('touchend', onTouch, false);
      function onTouch(event) {
        screenMaterial.emissiveMap = loader.load(assetList[count]);
        if (count == assetList.length - 1) {
          count = 0;
        }
        else {
          count++;
        }
      }

      document.addEventListener('keyup', event => {
        if (event.code === 'Space') {
          onTouch(event);
        }
      })

    </script>
  </div>


</body>

</html>