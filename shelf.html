<!DOCTYPE html>
<html>
	<head>
		<title>Proof of Concept Pei Pei</title>
        <link rel="stylesheet" href="finalproj.css">
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200&display=swap" rel="stylesheet">
	</head>
	<body>
		
		<div class="content">

		
		<div style="position: relative; text-align: center">
            <img src="img/worry.png" style="width:80%">
        </div>
		
		<canvas id = "three">
		<script src="threejs/build/three.js"></script>
        <script src="threejs/examples/js/loaders/GLTFLoader.js"></script>
        <script type="module">
        import { OrbitControls } from '/threejs/examples/js/controls/OrbitControls.js';
		import { GUI } from '/three/dat.gui.module.js';

		var container, controls;
		var camera, scene, renderer;
		var mesh;
		var model, model2, model3, model4, computer, commputer1, shelf;
        var g2model, g2model2, g2model3, g2shelf;

		var LOWESTHEIGHT = 1.75;
		
		var SPEED = 0.02;

		let cloudParticles = [];
		let cloud;
		
        let group1= [];
        let group2= [];



		init();
		animate();


		function init() {

			//loader

			let manager = new THREE.LoadingManager();
			manager.onProgress = function (url, itemsLoaded, itemsTotal) {
				console.log( 'Loaded ' + itemsLoaded + ' of ' + itemsTotal + ' files.' );
			};

			manager.onLoad = function () {
				//loadingScreen.parentNode.removeChild(loadingScreen);
				alert("Almost loaded...");
				console.log('all items loaded');

			};
			manager.onError = function () {
				console.log('there has been an error');
			}

			//basics

			camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.25, 200);
			camera.position.set(0,0,0);
            camera.position.z += 7;
			camera.position.y += LOWESTHEIGHT;


			scene = new THREE.Scene();
			scene.background = new THREE.Color(0x0c405c);


			const light = new THREE.HemisphereLight( 0x5c5c94, 0x8d729e, 3 );
 			scene.add( light );

			// create the cubemap
			var cubemap = new THREE.CubeTextureLoader()
			.setPath( 'img/' )
			.load( [
				'mecube.png',
				'mecube.png',
				'mecube.png',
				'mecube.png',
				'mecube.png',
				'mecube.png'
			] );

            var wallMaterial = new THREE.MeshStandardMaterial( { //material to for disco ball
				bumpMap: new THREE.TextureLoader().load("img/threedisco.png"),
              	bumpScale: 0.01,
                metalness: 1,
				roughness: 0.05,
				color: 0xffffff,
				envMap: cubemap,
			} );
            wallMaterial.side = THREE.DoubleSide;

			//material
			var fenceMaterial = new THREE.MeshStandardMaterial( { //material to for disco ball
				metalness: 1,
				roughness: 0.2,
				color: 0xFFFFFF,
				envMap: cubemap,
				morphTargets: true,
				morphNormals:true,
			} );
            fenceMaterial.side = THREE.DoubleSide;
			
			// model
            var loader = new THREE.GLTFLoader(manager);
            
			loader.load("models/doubleshelf.gltf", function (gltf) {
                gltf.scene.traverse( function ( child ) {
                if ( child.isMesh ) {
                    child.material.envMap = cubemap;
                }
                } );
				model = gltf.scene.getObjectByName("model");
				model.material = fenceMaterial;
				model.geometry.morphTargets = true;

                computer = gltf.scene.getObjectByName("computer");
				computer.material = fenceMaterial;

                shelf = gltf.scene.getObjectByName("shelf").clone();
                shelf.position.set(-2.5,-6,0);
                scene.add(shelf);

                gltf.scene.position.set(0,-1.5,0);

				scene.add(gltf.scene);

			});
            


			// renderer and controls
			renderer = new THREE.WebGLRenderer({ antialias: true, canvas: document.getElementById("three")});
			renderer.setPixelRatio(window.devicePixelRatio/2);
			renderer.setSize(window.innerWidth *0.8, window.innerHeight*0.8);
			//container.appendChild(renderer.domElement)
			//controls = new OrbitControls( camera, renderer.domElement );
			//controls.enableZoom = false;

		
		let tloader = new THREE.TextureLoader();
				tloader.load("img/smoke.png", function(texture){
				const cloudGeo = new THREE.PlaneBufferGeometry(40,40);
				const cloudMaterial = new THREE.MeshLambertMaterial({
					map:texture,
					transparent: true
				});

				for(let p=0; p<15; p++) {
					cloud = new THREE.Mesh(cloudGeo, cloudMaterial);
					cloud.position.set(
					Math.random()*5-5, 
					Math.random()*10 -4 + p, //up
					-p - 3 //forward
					);
					cloud.rotation.z = Math.random()*2*Math.PI;
					cloud.material.opacity = 0.35;
					cloudParticles.push(cloud);
					scene.add(cloud);

				
				}

			});

		
		}
	
		function animate() {
			requestAnimationFrame(animate);
			renderer.render(scene, camera);
		}

        var oldY = 0;
        var oldX = 0;
        window.addEventListener('mousemove', onMouseMove, false);
        function onMouseMove( ev ){
            var deltaX = oldX - ev.clientX;
            oldX = ev.clientX;

            
            if(model.morphTargetInfluences[0]<1 && deltaX>0){
                model.morphTargetInfluences[0] += 0.01;
			}
            else if (model.morphTargetInfluences[0]>0 && deltaX<0){
                model.morphTargetInfluences[0] -= 0.01;
            }
            
            
            
        }
		
			
		window.addEventListener( 'resize', onWindowResize, false );
			function onWindowResize(){
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();
				renderer.setSize( window.innerWidth*0.8, window.innerHeight *0.8);
		}

		window.addEventListener( 'scroll', onMouseWheel );
		window.addEventListener( 'wheel', onMouseWheel );
        function onMouseWheel( ev ) {
            var amount = ev.deltaY;
            if (amount<0){
                 camera.position.y -= SPEED;
                 if(computer.morphTargetInfluences[0]<1){
                    computer.morphTargetInfluences[0] += 0.01;
			        }
			}
            else{
                 camera.position.y += SPEED;
                 if(computer.morphTargetInfluences[0]>0){
                    computer.morphTargetInfluences[0] -= 0.01;
			    }
            }
        }
		</script>
		
	</canvas>

		Scroll to navigate.
	</div>

		<div class="button" value="PLAY" onclick="play()">
			<span>
				Play Audio
			</span>
				<audio id="audio" src="img/soundtrack.mp3"></audio>	  
		</div>

		<script>
			function play() {
			  var audio = document.getElementById("audio");
			  if (audio.paused) {
            		audio.play();
           
       		 }else{
            audio.pause();
            audio.currentTime = 0
        	}
			}
		</script>
	</body>
</html>