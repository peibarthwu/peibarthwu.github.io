<!DOCTYPE html>
<html>
	<head>
		<title>Proof of Concept Pei Pei</title>
		<link rel="stylesheet" href="testscene.css">
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200&display=swap" rel="stylesheet">
	</head>
	<body>
		<div id="overlay">
			<button id="startButton" class= "button">Enable Controls</button>
		</div>
		<div id = "three">
		<script src="threejs/build/three.js"></script>
        <script src="threejs/examples/js/loaders/GLTFLoader.js"></script>
        <script type="module">
        import { OrbitControls } from '/threejs/examples/jsm/controls/OrbitControls.js';
		import { GUI } from '/three/dat.gui.module.js';
        import TWEEN from 'https://cdn.jsdelivr.net/npm/@tweenjs/tween.js@18.5.0/dist/tween.esm.js';

		var container, controls;
		var camera, scene, renderer, light, kaiju;
		var mesh;
        var group = [];
        var tween;

        let mouseX = 0;
        let mouseY = 0;
        const mouse = new THREE.Vector2();

        const raycaster = new THREE.Raycaster();

        var positions = [];
        positions.push(new THREE.Vector3(-15, 0, 0));
        positions.push(new THREE.Vector3(0, 5, -15));
        positions.push(new THREE.Vector3(15, 10, 0));
        positions.push(new THREE.Vector3(0, 15, 15));
        positions.push(new THREE.Vector3(-15, 35, 0));




		init();
        // setUpTween(positions[0] );
		animate();
		function init() {

			//basics
			container = document.createElement('three');
			document.body.appendChild(container);

			camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.25, 200);
			camera.position.set(-50,100,50);

			scene = new THREE.Scene();
			scene.background = new THREE.Color(0x000022);

			let orangeLight = new THREE.PointLight(0x175575,10,10);
			orangeLight.position.set(20,30,2);
			scene.add(orangeLight);

			let blueLight = new THREE.PointLight(0x175575,4,0);
			blueLight.position.set(-10,10,12);
			scene.add(blueLight);

            const light = new THREE.HemisphereLight( 0xeb34cf, 0xeb34cf, 1 );
            scene.add( light );

			var cubemap = new THREE.CubeTextureLoader()
			.setPath( 'img/' )
			.load( [
            'px.png',
            'nx.png',
            'py.png',
            'ny.png',
            'pz.png',
            'nz.png'
			] );
			scene.background= cubemap;

            var wallMaterial = new THREE.MeshStandardMaterial( { //material to for disco ball
                metalness: 0.1,
				roughness: 0.5,
				color: 0x222222,
				envMap: cubemap,
			} );
            wallMaterial.side = THREE.DoubleSide;

			
			// model
			var loader = new THREE.GLTFLoader();
			loader.load("models/city2.gltf", function (gltf) {
                gltf.scene.getObjectByName("Plane").material = wallMaterial;

                //group.push(gltf.scene.getObjectByName("arrow"));
                // group.add(gltf.scene.getObjectByName("arrow2"));
                // group.add(gltf.scene.getObjectByName("arrow.001"));

				scene.add(gltf.scene);


			});

			// renderer and controls
			renderer = new THREE.WebGLRenderer({ antialias: true });
			renderer.setPixelRatio(window.devicePixelRatio);
			renderer.setSize(window.innerWidth, window.innerHeight);
			container.appendChild(renderer.domElement);

            controls = new OrbitControls( camera, renderer.domElement );
            controls.minDistance = 3;
            controls.maxDistance = 50;
		}

       

        // function setUpTween(to){
        //     var from = {
        //         x : camera.position.x,
        //         y : camera.position.y,
        //         z : camera.position.z
        //     };

        //     var tween = new TWEEN.Tween(from)
        //     .to(to,600)
        //     .easing(TWEEN.Easing.Linear.None)
        //     .onUpdate(function () {
        //         camera.position.set(this.x, this.y, this.z);
        //         camera.lookAt(new THREE.Vector3(0,0,0));
        //     })
        //     .onComplete(function () {
        //         camera.lookAt(new THREE.Vector3(0,0,0));
        //     })
        //     .start();
        // }
		
       
		function animate() {
			requestAnimationFrame(animate);
            // camera.position.x += ( mouse.x - camera.position.x ) * .05;
            // camera.position.y += ( - mouse.y - camera.position.y ) * .05;

             camera.lookAt( scene.position );
             TWEEN.update();

            // update the picking ray with the camera and mouse position
            raycaster.setFromCamera( mouse, camera );
			controls.update();
            renderer.render( scene, camera );
            
		}
		
		window.addEventListener( 'resize', onWindowResize, false );
		function onWindowResize(){
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();
				renderer.setSize( window.innerWidth , window.innerHeight);
		}

        var count = 0;
        document.addEventListener('keyup', onSpace);
        function onSpace(){
            if (event.code === 'Space') {
                if (count == positions.length - 1){
                    count = 0;
                }
                else{
                    count ++;
                }
                console.log(positions[count]);
                var tween = new TWEEN.Tween(camera.position).to(positions[count], 2000).start()
            }
        }

		</script>
		</div>
	</body>
</html>